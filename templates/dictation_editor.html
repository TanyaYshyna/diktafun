<!DOCTYPE html>
<html>

<head>
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style_color.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/style_dictation_editor.css">
    <link rel="icon" href="data:,"> <!-- –ü—É—Å—Ç–∞—è –∏–∫–æ–Ω–∫–∞ -->

    <!-- WaveformCanvas -->
    <script src="{{ url_for('static', filename='js/waveform_canvas.js') }}"></script>
</head>

<body>
    <div class="topbar">
        <!-- <img src="/static/icons/logo.svg" class="logo"> -->
        <img src="/static/icons/logo.svg" class="logo" onclick="handleLogoClick()">
        <div class="user-section" id="user-section">
            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è JavaScript -->
            <a href="/user/profile" class="username">
                <span class="user-avatar-small"></span>
                <span class="username-text"></span>
            </a>
            <button class="streak">üî• <span class="streak-days">0</span> –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</button>

        </div>
    </div>

    <div class="panel">
        <div class="header-container">
            <div id="langPair" data-original="{{ original_language }}" data-translation="{{ translation_language }}">
                <!-- –§–ª–∞–≥–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ language_selector.js -->
            </div>
            <div>
                <h2 id="dictation-name">–ù–æ–≤—ã–π –¥–∏–∫—Ç–∞–Ω—Ç: </h2>
            </div>
            <div class="button-group">
                <button id="saveBtn" class="button-color-yellow" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∏–∫—Ç–∞–Ω—Ç">
                    <i data-lucide="save"></i>
                    <!-- <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span> -->
                </button>
                <button id="saveAndExitBtn" class="button-color-yellow" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∏–∫—Ç–∞–Ω—Ç –∏ –≤—ã–π—Ç–∏">
                    <i data-lucide="save"></i>
                    <i data-lucide="log-out"></i>
                    <!-- <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏</span> -->
                </button>
            </div>
        </div>


        <!-- –ö–Ω–æ–ø–∫–∞ "–í–Ω–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç –∑–∞–Ω–æ–≤–æ" (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∫—Ç–∞–Ω—Ç–∞) -->
        <div id="reenterTextSection" style="display: none;">
            <button id="reenterTextBtn" class="button-color-yellow">üîÑ –í–Ω–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç –∑–∞–Ω–æ–≤–æ</button>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ (–∫–æ—Ä–µ—à–∫–∏) -->
        <div id="settingsTabsPanel" class="settings-tabs-panel">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="general">
                    <span>1. –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ</span>
                </button>
                <button class="tab-btn" data-tab="audio">
                    <span>2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ</span>
                </button>
                <button class="tab-btn" data-tab="dialog">
                    <span>3. –î–∏–∞–ª–æ–≥</span>
                </button>
                <button class="tab-btn" data-tab="create-audio">
                    <span>4. –°–æ–∑–¥–∞–Ω–∏–µ –∞—É–¥–∏–æ</span>
                </button>
            </div>

            <div class="tabs-body">
                <!-- –í–∫–ª–∞–¥–∫–∞ 1: –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ -->
                <div id="tab-general" class="tab-content active">
                    <div class="general-data-content">
                        <div class="editor-header">
                            <div class="editor-header-panel-1">
                                <div class="cover-section">
                                    <div class="cover-display">
                                        <img id="coverImage"
                                            src="/static/data/covers/cover_{{ original_language }}.webp" alt="Cover" />
                                    </div>
                                    <div class="cover-upload">
                                        <input type="file" id="coverFile" accept="image/*" style="display: none;">
                                        <button id="coverUploadBtn" class="button-color-yellow">
                                            <i data-lucide="download"></i>
                                            –ó–∞–≥—Ä—É–∑–∏—Ç—å
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="editor-header-panel-2">

                                <div id="category-path"></div>
                                <div class="form-group-line">
                                    <label style="color: var(--color-button-text-lightgreen);">{{ original_language
                                        }}:</label>
                                    <input class="text-input" type="text" id="title" required>
                                </div>
                                <div class="form-group-line">
                                    <label style="color: var(--color-button-text-yellow);">{{ translation_language
                                        }}:</label>
                                    <input class="text-input" type="text" id="title_translation" required>
                                </div>
                                <!-- –°–ø–∏–∫–µ—Ä—ã (–æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤) -->
                                <div id="speakersDisplay" class="speakers-display" style="display: none;">
                                    <label>–°–ø–∏–∫–µ—Ä—ã:</label>
                                    <div id="speakersList"></div>
                                </div>
                                <label id="dictation-id">–ù–æ–≤—ã–π –¥–∏–∫—Ç–∞–Ω—Ç: </label>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ -->
                <div id="tab-audio" class="tab-content">
                    <div class="audio-settings-content">
                        <table class="audio-settings-table">
                            <tr>
                                <td class="radio-cell">
                                    <!-- –†–∞–¥–∏–æ –∫–Ω–æ–ø–∫–∏ -->
                                    <div class="audio-mode-controls">
                                        <label class="radio-label">
                                            <input type="radio" name="audioMode" value="full" checked>
                                            <i data-lucide="aperture" class="radio-icon radio-icon-selected"></i>
                                            <i data-lucide="circle" class="radio-icon radio-icon-unselected"
                                                style="display: none;"></i>
                                            <span>–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤–µ—Å—å —Ñ–∞–π–ª</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="audioMode" value="sentence">
                                            <i data-lucide="aperture" class="radio-icon radio-icon-selected"
                                                style="display: none;"></i>
                                            <i data-lucide="circle" class="radio-icon radio-icon-unselected"></i>
                                            <span>–¢–µ–∫—É—â–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="audioMode" value="mic">
                                            <i data-lucide="aperture" class="radio-icon radio-icon-selected"
                                                style="display: none;"></i>
                                            <i data-lucide="circle" class="radio-icon radio-icon-unselected"></i>
                                            <span>–ó–∞–ø–∏—Å—å —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="audioMode" value="auto">
                                            <i data-lucide="aperture" class="radio-icon radio-icon-selected"
                                                style="display: none;"></i>
                                            <i data-lucide="circle" class="radio-icon radio-icon-unselected"></i>
                                            <span>–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ</span>
                                        </label>
                                    </div>
                                </td>
                                <td class="controls-cell">
                                    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–æ–ª–Ω—ã –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                                    <div id="waveformAndControls" class="waveform-and-controls">
                                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ (–¥–ª—è —Ä–µ–∂–∏–º–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞) -->
                                        <div class="file-selection-content">
                                            <div class="file-selection-header">
                                                <span id="currentAudioInfo">–ê—É–¥–∏–æ –¥–ª—è –≤–æ–ª–Ω—ã: –Ω–µ –≤—ã–±—Ä–∞–Ω–æ</span>
                                                <button type="button" id="selectFileBtn" class="file-select-btn"
                                                    title="–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª">...
                                                    <!-- <i data-lucide="more-horizontal"></i> -->
                                                </button>
                                            </div>
                                            <div class="file-selection-body">
                                                <span id="currentSentenceInfo">–°—Ç—Ä–æ–∫–∞ —Ç–∞–±–ª–∏—Ü—ã: –Ω–µ –≤—ã–±—Ä–∞–Ω–∞</span>
                                            </div>
                                        </div>
                                        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–æ–ª–Ω—ã -->
                                        <div id="waveformContainer" class="waveform-container">
                                            <div id="audioWaveform"></div>
                                        </div>

                                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º -->
                                        <div class="playback-controls">
                                            <button type="button" id="audioPlayBtn" class="audio-btn"
                                                data-field-name="audio_user_shared" data-state="ready-shared"
                                                data-language="en" data-original-state="ready-shared">
                                                <i data-lucide="play"></i>
                                            </button>
                                            <div id="timeControls" class="time-controls">
                                                <label for="audioStartTime">Start:</label>
                                                <input type="number" id="audioStartTime" step="0.01" min="0">
                                                <label for="audioEndTime">End:</label>
                                                <input type="number" id="audioEndTime" step="0.01" min="0">
                                            </div>
                                            <button type="button" id="scissorsBtn" class="button-standard">
                                                <i data-lucide="scissors"></i>
                                            </button>
                                            <button type="button" id="audioTableActionBtn" class="button-standard"
                                                title="–†–∞–∑—Ä–µ–∑–∞—Ç—å –∞—É–¥–∏–æ –Ω–∞ 1000 –∫—É—Å–∫–æ–≤">
                                                <i data-lucide="scissors"></i>
                                                <span>–Ω–∞ 1000 –∫—É—Å–∫–æ–≤</span>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å JavaScript -->
                                    <div style="display: none;">
                                        <input type="number" id="startTime" step="0.01" min="0">
                                        <input type="number" id="endTime" step="0.01" min="0">
                                    </div>

                                    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤ -->
                                    <input type="file" id="audioFileInput" accept="audio/*" style="display: none;">
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ 3: –î–∏–∞–ª–æ–≥ -->
                <div id="tab-dialog" class="tab-content">
                    <div class="dialog-content">
                        <div class="form-group">
                            <label class="checkbox-label" id="tabDialogCheckboxLabel">
                                <input type="checkbox" id="tabIsDialogCheckbox" style="display: none;">
                                <i data-lucide="circle" class="checkbox-icon"></i>
                                –≠—Ç–æ –¥–∏–∞–ª–æ–≥
                            </label>
                        </div>
                        <div id="tabSpeakersTable" class="speakers-table" style="display: none;">
                            <h3>–°–ø–∏–∫–µ—Ä—ã</h3>
                            <table id="tabSpeakersTableContent">
                                <tbody>
                                    <tr>
                                        <td>1:</td>
                                        <td><input type="text" class="speaker-name" value="–°–ø–∏–∫–µ—Ä 1"
                                                placeholder="–ò–º—è —Å–ø–∏–∫–µ—Ä–∞">
                                        </td>
                                        <td>
                                            <button type="button" class="remove-speaker" title="–£–¥–∞–ª–∏—Ç—å —Å–ø–∏–∫–µ—Ä–∞">
                                                <i data-lucide="trash-2"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>2:</td>
                                        <td><input type="text" class="speaker-name" value="–°–ø–∏–∫–µ—Ä 2"
                                                placeholder="–ò–º—è —Å–ø–∏–∫–µ—Ä–∞">
                                        </td>
                                        <td>
                                            <button type="button" class="remove-speaker" title="–£–¥–∞–ª–∏—Ç—å —Å–ø–∏–∫–µ—Ä–∞">
                                                <i data-lucide="trash-2"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <button type="button" id="tabAddSpeakerBtn" title="–î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏–∫–µ—Ä–∞">
                                <i data-lucide="user-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ 4: –°–æ–∑–¥–∞–Ω–∏–µ –∞—É–¥–∏–æ -->
                <div id="tab-create-audio" class="tab-content">
                    <div class="create-audio-content">
                        <table id="create-audio-table">
                            <tr>
                                <td class="create-cell">
                                    <div class="create-audio-controls">
                                        <div class="form-group-line">
                                            <label for="audioTypeInput">–ê—É–¥–∏–æ-—à–∏—Ñ—Ä:</label>
                                            <input type="text" id="audioTypeInput" class="text-input" value="op"
                                                placeholder="op">
                                            <button id="createAudioFileBtn" class="button-color-yellow"
                                                title="–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª">
                                                <i data-lucide="file-plus"></i>
                                            </button>
                                        </div>
                                        <div class="form-group-line">
                                            <button id="playCreatedAudioBtn" class="button-standard audio-btn"
                                                data-state="disabled">
                                                <i data-lucide="play"></i>
                                            </button>
                                            <div class="audio-file-name-container">
                                                <label id="audioFileNameLabel" class="audio-file-name-label">
                                                    –ò–º—è —Ñ–∞–π–ª–∞:-
                                                </label>
                                                <div class="audio-file-dropdown-wrapper" style="display: none;">
                                                    <button id="audioFileDropdownBtn" class="audio-file-dropdown-btn">
                                                        <i data-lucide="chevron-down"></i>
                                                    </button>
                                                    <div id="audioFileDropdown" class="audio-file-dropdown"
                                                        style="display: none;">
                                                        <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group-line">
                                            <button id="saveAudioFileBtn" class="button-color-yellow"
                                                title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫">
                                                <i data-lucide="download"></i>
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td class="explanations-cell">
                                    <div class="audio-explanations">
                                        <label>–û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:</label>
                                        <ul class="explanations-list">
                                            <li><strong>o</strong> - –∞—É–¥–∏–æ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞</li>
                                            <li><strong>t</strong> - –∞—É–¥–∏–æ –ø–µ—Ä–µ–≤–æ–¥–∞</li>
                                            <li><strong>a</strong> - –∞—É–¥–∏–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
                                            <li><strong>f</strong> - –∞—É–¥–∏–æ –≤—ã—Ä–µ–∑–∞–Ω–Ω–æ–µ –∏–∑ —Ñ–∞–π–ª–∞</li>
                                            <li><strong>m</strong> - –∞—É–¥–∏–æ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</li>
                                            <li><strong>p</strong> - –ø–∞—É–∑–∞</li>
                                            <li><strong>p_a</strong> - –ø–∞—É–∑–∞ –¥–ª–∏–Ω–Ω–æ–π –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∞—É–¥–∏–æ</li>
                                        </ul>
                                    </div>

                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>



        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π -->
        <div class="main-content">
            <!-- –ì—Ä—É–ø–ø–∞ –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü–µ–π -->
            <div class="table-controls">
                <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã (—Å–ª–µ–≤–∞) -->
                <button id="refillTableBtn" class="table-control-btn refill-btn">
                    <i data-lucide="refresh-cw"></i>
                    –ü–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
                </button>

                <!-- –ì—Ä—É–ø–ø–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∞–º–∏ (—Å–ø—Ä–∞–≤–∞) -->
                <div class="table-nav-group">
                    <button id="prevRowBtn" class="table-control-btn nav-btn" title="–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞">
                        <i data-lucide="chevron-left"></i>
                    </button>

                    <div class="current-row-label">
                        <span id="currentRowNumber">1</span>
                    </div>

                    <button id="nextRowBtn" class="table-control-btn nav-btn" title="–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–æ–∫–∞">
                        <i data-lucide="chevron-right"></i>
                    </button>

                    <button id="addRowBtn" class="table-control-btn add-btn" title="–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                        <i data-lucide="plus"></i>
                    </button>

                    <button id="deleteRowBtn" class="table-control-btn delete-btn" title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                        <i data-lucide="trash-2"></i>
                    </button>
                </div>
            </div>

            <div class="sentences-table-wrapper">
                <table id="sentences-table">
                    <thead>
                        <tr>
                            <th class="col-number">‚Ññ</th>
                            <th class="col-checkbox-create-audio panel-create-audio" style="display: none;">
                                <label class="checkbox-label" id="selectAllCheckboxLabel" style="cursor: pointer;">
                                    <input type="checkbox" id="selectAllCheckbox" style="display: none;">
                                    <i data-lucide="circle" class="checkbox-icon"></i>
                                </label>
                            </th>
                            <th class="col-speaker" style="display: none;">
                                <i data-lucide="user"></i>
                            </th>

                            <th class="col-original panel-original">–û—Ä–∏–≥–∏–Ω–∞–ª</th>
                            <th class="col-play-original panel-original panel-create-audio">o</th>


                            <th class="col-translation panel-translation">–ü–µ—Ä–µ–≤–æ–¥</th>
                            <th class="col-play-translation panel-translation panel-create-audio">t</th>

                            <th class="col-generate-tts panel-editing-avto panel-create-audio">a</th>
                            <th class="col-apply-avto panel-editing-avto" title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å">
                                <i data-lucide="arrow-big-left-dash"></i>
                            </th>

                            <!-- <th class="col-checkbox panel-editing"><i data-lucide="check"></i></th> -->
                            <!-- <th class="col-audio-file panel-editing">–§–∞–π–ª</th> -->
                            <th class="col-start panel-editing-user">Start</th>
                            <th class="col-end panel-editing-user">End</th>
                            <th class="col-chain panel-editing-user"><i data-lucide="link"></i></th>
                            <th class="col-play-audio panel-editing-user panel-create-audio">f</th>
                            <th class="col-apply-user panel-editing-user" title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å">
                                <i data-lucide="arrow-big-left-dash"></i>
                            </th>

                            <th class="col-play-audio panel-editing-mic panel-create-audio">m</th>
                            <th class="col-apply-mic panel-editing-mic" title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å">
                                <i data-lucide="arrow-big-left-dash"></i>
                            </th>
                            <th class="col-scrolling"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –°—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!------------------------------------------>
    <!------------------------------------------>
    <!------------------------------------------>
    <!-- –°—Ç–∞—Ä—Ç–æ–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="startModal" class="modal-overlay" style="display: none;">
        <div class="modal-content start-modal">
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∫—Ç–∞–Ω—Ç–∞</h2>

            <div class="form-group-line">
                <div class="form-group">
                    <label class="checkbox-label" id="dialogCheckboxLabel">
                        <input type="checkbox" id="isDialogCheckbox" style="display: none;">
                        <i data-lucide="circle" class="checkbox-icon"></i>
                        –≠—Ç–æ –¥–∏–∞–ª–æ–≥
                    </label>
                </div>
                <div class="form-group">
                    <label for="translationDelimiter">–°–∏–º–≤–æ–ª –Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞:</label>
                    <input type="text" id="translationDelimiter" value="/*" placeholder="/*">
                </div>
            </div>
            <div id="speakersTable" class="speakers-table" style="display: none;">
                <h3>–°–ø–∏–∫–µ—Ä—ã</h3>
                <table id="speakersTableContent">
                    <!-- <thead>
                            <tr>
                                <th>‚Ññ</th>
                                <th>–ò–º—è —Å–ø–∏–∫–µ—Ä–∞</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead> -->
                    <tbody>
                        <tr>
                            <td>1:</td>
                            <td><input type="text" class="speaker-name" value="–°–ø–∏–∫–µ—Ä 1" placeholder="–ò–º—è —Å–ø–∏–∫–µ—Ä–∞">
                            </td>
                            <td>
                                <button type="button" class="remove-speaker" title="–£–¥–∞–ª–∏—Ç—å —Å–ø–∏–∫–µ—Ä–∞">
                                    <i data-lucide="trash-2"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>2:</td>
                            <td><input type="text" class="speaker-name" value="–°–ø–∏–∫–µ—Ä 2" placeholder="–ò–º—è —Å–ø–∏–∫–µ—Ä–∞">
                            </td>
                            <td>
                                <button type="button" class="remove-speaker" title="–£–¥–∞–ª–∏—Ç—å —Å–ø–∏–∫–µ—Ä–∞">
                                    <i data-lucide="trash-2"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" id="addSpeakerBtn" title="–î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏–∫–µ—Ä–∞">
                    <i data-lucide="user-plus"></i>
                </button>
            </div>


            <div class="form-group">
                <label for="startTextInput">–¢–µ–∫—Å—Ç –¥–∏–∫—Ç–∞–Ω—Ç–∞:</label>
                <div id="startTextInput" contenteditable="true" class="start-text-editor" rows="10"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–∏–∫—Ç–∞–Ω—Ç–∞..."></div>
            </div>


            <div class="modal-buttons">
                <button type="button" id="cancelStartBtn">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" id="createDictationBtn">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–∏–∫—Ç–∞–Ω—Ç</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞ -->
    <div id="createAudioFileModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>–°–æ–∑–¥–∞—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª</h2>
            <div class="form-group">
                <label for="newAudioFileName">–ò–º—è —Ñ–∞–π–ª–∞:</label>
                <input type="text" id="newAudioFileName" class="text-input" placeholder="audio_op.mp3" value="">
                <small>–§–∞–π–ª –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ temp –ø–∞–ø–∫–µ –¥–∏–∫—Ç–∞–Ω—Ç–∞</small>
            </div>
            <div class="modal-buttons">
                <button id="createAudioFileModalConfirm" class="button-color-yellow">
                    <i data-lucide="file-plus"></i>
                    –°–æ–∑–¥–∞—Ç—å
                </button>
                <button id="createAudioFileModalCancel" class="button-standard">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ -->
    <div id="addRowModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É</h3>
                <button class="modal-close" onclick="closeAddRowModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>–í—ã–±–µ—Ä–∏—Ç–µ, –≥–¥–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ç—Ä–æ–∫–∏ <span id="addRowCurrentNumber">12</span>:</p>
            </div>
            <div class="modal-footer modal-footer-three">
                <button class="modal-btn modal-btn-secondary transparent" onclick="closeAddRowModal()">
                    <i data-lucide="x"></i>
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button class="modal-btn modal-btn-secondary" onclick="confirmAddRow('above')">
                    <i data-lucide="arrow-up"></i>
                    –°–≤–µ—Ä—Ö—É —Å—Ç—Ä–æ–∫–∏ <span id="addRowAboveNumber">12</span>
                </button>
                <button class="modal-btn modal-btn-secondary" onclick="confirmAddRow('below')">
                    <i data-lucide="arrow-down"></i>
                    –°–Ω–∏–∑—É —Å—Ç—Ä–æ–∫–∏ <span id="addRowBelowNumber">12</span>
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ -->
    <div id="deleteRowModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É</h3>
                <button class="modal-close" onclick="closeDeleteRowModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É <span id="deleteRowNumber">12</span>?</p>
                <p class="modal-warning">–ö–ª—é—á: <code id="deleteRowKey">001</code></p>
                <p class="modal-warning">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeDeleteRowModal()">
                    <i data-lucide="x"></i>
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button class="modal-btn modal-btn-danger" onclick="confirmDeleteRow()">
                    <i data-lucide="trash-2"></i>
                    –£–¥–∞–ª–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞–ø–∏—Å–∏ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ -->
    <div id="micRecordModal" class="modal-overlay" style="display: none;">
        <div class="modal-content mic-record-modal">
            <div class="modal-header">
                <h3>–ó–∞–ø–∏—Å—å —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</h3>
                <button class="modal-close" onclick="closeMicRecordModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="mic-record-content">
                    <div class="sentence-text-display">
                        <label>–¢–µ–∫—Å—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏:</label>
                        <div id="micRecordSentenceText" class="sentence-text"></div>
                    </div>

                    <div class="recording-controls">
                        <div class="recording-status">
                            <div id="recordingIndicator" class="recording-indicator">
                                <div class="recording-dot"></div>
                                <span id="recordingStatusText">–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø–∏—Å–∏</span>
                            </div>
                            <div id="recordingTimer" class="recording-timer">00:00</div>
                        </div>

                        <div class="recording-buttons">
                            <button id="startRecordBtn" class="modal-btn modal-btn-primary">
                                <i data-lucide="mic"></i>
                                –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
                            </button>
                            <button id="stopRecordBtn" class="modal-btn modal-btn-secondary" style="display: none;">
                                <i data-lucide="square"></i>
                                –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>

                    <div id="playbackSection" class="playback-section" style="display: none;">
                        <div class="playback-controls">
                            <button id="playRecordBtn" class="modal-btn modal-btn-secondary">
                                <i data-lucide="play"></i>
                                –ü—Ä–æ—Å–ª—É—à–∞—Ç—å
                            </button>
                            <button id="rerecordBtn" class="modal-btn modal-btn-secondary">
                                <i data-lucide="rotate-ccw"></i>
                                –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å
                            </button>
                        </div>
                        <div class="playback-info">
                            <span id="playbackDuration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: --:--</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary transparent" onclick="closeMicRecordModal()">
                    <i data-lucide="x"></i>
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button id="saveRecordBtn" class="modal-btn modal-btn-primary" style="display: none;">
                    <i data-lucide="save"></i>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å
                </button>
            </div>
        </div>
    </div>



    <!--------- –°–ö–†–ò–ü–¢–´ –∏ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---------------------------------------->
    <script src="{{ url_for('static', filename='js/lucide.js') }}"></script>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç—ã LanguageManager –∏ LanguageSelector -->
    <script src="{{ url_for('static', filename='js/audio_manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/language_manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/language_selector.js') }}"></script>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç—ã UserManager -->
    <script src="{{ url_for('static', filename='js/user_manager.js') }}"></script>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Lucide –∏–∫–æ–Ω–∫–∏
        lucide.createIcons();
    </script>

    <script id="init-data" type="application/json">
    {{ {
        "dictation_id": dictation_id,
        "original_language": original_language,
        "translation_language": translation_language,
        "original_data": original_data,
        "translation_data": translation_data,
        "audio_file": audio_file,
        "title": title,
        "level": level,
        "audio_words": audio_words,
        "safe_email": safe_email,
        "category_info": category_info,
        "is_dialog": is_dialog,
        "speakers": speakers
     } | tojson }}
    </script>


    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –°–ò–ù–•–†–û–ù–ù–û -->
    <script src="{{ url_for('static', filename='js/script_dictation_editor.js') }}"></script>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UserManager –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
        document.addEventListener('DOMContentLoaded', async function () {
            // console.log('üöÄ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –¥–∏–∫—Ç–∞–Ω—Ç–∞...');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ LanguageManager –∑–∞–≥—Ä—É–∂–µ–Ω
            // if (window.LanguageManager) {
            //     console.log('‚úÖ LanguageManager –¥–æ—Å—Ç—É–ø–µ–Ω');
            // }

            if (!window.UM) {
                console.warn('‚ö†Ô∏è UserManager –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä');
                window.UM = new UserManager({ apiBase: '/user/api' });
            } else {
                // console.log('‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π UserManager');
            }

            try {
                // –¢–µ–ø–µ—Ä—å –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
                if (typeof initDictationGenerator === 'function') {
                    initDictationGenerator();
                } else {
                    console.error('‚ùå script_dictation.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ');
                }
            } catch (error) {
                console.error('‚ùå JWT initialization error:', error);
                // –î–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–æ–±—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä
                if (typeof initDictationGenerator === 'function') {
                    initDictationGenerator();
                }
            }
        });
    </script>

</body>

</html>