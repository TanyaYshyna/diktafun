<!DOCTYPE html>
<html>

<head>
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style_color.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/style_dictation_generator.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- FancyTree -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.fancytree@2/dist/skin-lion/ui.fancytree.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery.fancytree@2.38.2/dist/jquery.fancytree-all-deps.min.js"></script>

    <!-- WaveformCanvas -->
    <link rel="icon" href="data:,"> <!-- –ü—É—Å—Ç–∞—è –∏–∫–æ–Ω–∫–∞ -->
    <script src="{{ url_for('static', filename='js/waveform_canvas.js') }}"></script>
</head>

<body>
    <div class="topbar">
        <!-- <img src="/static/icons/logo.svg" class="logo"> -->
        <img src="/static/icons/logo.svg" class="logo" onclick="window.location.href='/'">
        <div class="user-section" id="user-section">
            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è JavaScript -->
            <a href="/user/profile" class="username">
                <span class="user-avatar-small"></span>
                <span class="username-text"></span>
            </a>
            <button class="streak">üî• <span class="streak-days">0</span> –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</button>

        </div>
    </div>

    <div class="panel">
        <div class="container" style="display: flex">
            <div id="langPair" data-original="{{ original_language }}" data-translation="{{ translation_language }}">
                {{ original_language }} ‚áí {{ translation_language }}
            </div>
            <h2 id="dictation-id">–ù–æ–≤—ã–π –¥–∏–∫—Ç–∞–Ω—Ç: </h2>
        </div>

        <!-- –®–∞–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Å –¥–≤—É–º—è –ø–∞–Ω–µ–ª—è–º–∏ -->
        <div class="editor-header">
            <div class="editor-header-panel-1">
                <div class="cover-section">
                    <div class="cover-display">
                        <img id="coverImage" src="/static/data/covers/cover_{{ original_language }}.webp" alt="Cover" />
                    </div>
                    <div class="cover-upload">
                        <input type="file" id="coverFile" accept="image/*" style="display: none;">
                        <button id="coverUploadBtn" class="button-color-lightgreen">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    </div>
                </div>
            </div>
            <div class="editor-header-panel-2">
                <div class="form-group-line">
                    <label style="color: var(--color-button-text-lightgreen);">{{ original_language }}:</label>
                    <input class="text-input" type="text" id="title" required>
                </div>
                <div class="form-group-line">
                    <label style="color: var(--color-button-text-yellow);">{{ translation_language }}:</label>
                    <input class="text-input" type="text" id="title_translation" required>
                </div>
            </div>
        </div>

        <label style="color: var(--color-button-text-yellow);">–¢–µ–∫—Å—Ç –ø–æ —Ñ—Ä–∞–∑–∞–º (/* –ø—Ä–µ–≤–æ–¥):</label>
        <textarea id="text" type="text" rows="10"></textarea>

        <!-- —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –∑–∞–∫–ª–∞–¥–∫–∞–º–∏ –∫–∞–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ -->
        <div class="book-audio">

            <!-- –í–∫–ª–∞–¥–∫–∏ -->
            <div class="tabs">
                <button data-target="page-audio-avto">Avto</button>
                <button data-target="page-audio-mp3-1">.mp3 (en)</button>
                <button data-target="page-audio-mic"><i data-lucide="mic-off"></i></button>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã -->
            <section class="page" id="page-audio-avto">
                <button id="split-avto-btn" class="button-color-yellow">–†–∞–∑–±–∏—Ç—å –Ω–∞ —Ñ—Ä–∞–∑—ã –∏ –æ–∑–≤—É—á–∏—Ç—å</button>
                <button id="save-avto-btn" class="btn-save button-color-yellow">
                    <i data-lucide="save"></i> –ó–∞–ø–∏—Å–∞—Ç—å Audio-avto
                </button>
                –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞—É–¥–∏–æ —Å –ø–æ–º–æ—â—å—é —Å–µ—Ä–≤–∏—Å–æ–≤ –≥—É–≥–ª...
                <table id="sentences-table">
                    <thead>
                        <tr>
                            <th>‚Ññ</th>
                            <th>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–æ—Ä–∏–≥–∏–Ω–∞–ª/–ø–µ—Ä–µ–≤–æ–¥)</th>
                            <th>–°–æ–∑–¥–∞—Ç—å</th>
                            <th>–ü—Ä–æ–∏–≥—Ä–∞—Ç—å</th>
                            <!-- <th class="audio-dependent-column-display ">Start</th>
                            <th class="audio-dependent-column-display ">End</th>
                            <th class="audio-dependent-column-display ">Status</th>
                            <th class="audio-dependent-column-display ">–ò—Å—Ç–æ—á–Ω–∏–∫</th> -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –°—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </section>

            <section class="page" id="page-audio-mp3-1">
                –ó–∞–ø–æ–ª–Ω—è–µ–º –∞—É–¥–∏–æ –∏–∑ —Ñ–∞–π–ª–∞...
                <div class="panels-wagons">
                    <!-- –í–ê–ì–û–ù 1 -->
                    <div class="form-group-column">
                        <div class="form-group-line">
                            <!-- –°–ø—Ä—è—Ç–∞–Ω–Ω–æ–µ –Ω–∞—Å—Ç–æ—è—â–µ–µ –ø–æ–ª–µ –≤—ã–±–æ—Ä–∞ -->
                            <input type="file" id="mp3File" accept="audio/*" style="display: none;">
                            <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å -->
                            <div id="mp3FileStatus" style="color: var(--color-button-text-purple);">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω
                            </div>

                            <!-- –ö—Ä–∞—Å–∏–≤–∞—è –ª–æ–∂–Ω–∞—è –∫–Ω–æ–ø–∫–∞ -->
                            <button id="fakeMp3FileBtn" class="button-color-purple">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
                            
                            <!-- –ö–Ω–æ–ø–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã -->
                            <button id="createTableBtn" class="button-color-yellow">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
                            <button id="save-mp3-btn" class="button-color-yellow" style="display: none;">
                                <i data-lucide="save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å MP3 –¥–∏–∫—Ç–∞–Ω—Ç
                            </button>
                        </div>
                        <!-- –†–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è start/end -->
                        <div class="form-group-column">
                            <label style="color: var(--color-button-text-purple);">–†–µ–∂–∏–º:</label>
                            <label>
                                <input type="radio" name="waveMode" value="dictation" checked>
                                –ù–∞—á–∞–ª–æ/–∫–æ–Ω–µ—Ü –¥–∏–∫—Ç–∞–Ω—Ç–∞
                            </label>
                            <label>
                                <input type="radio" name="waveMode" value="sentence">
                                –ê–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
                            </label>
                        </div>

                        <div id="waveWrapper">
                            <div id="waveform"></div>
                        </div>

                        <span id="text-original-row" class="text-original">(1) –¢–µ–∫—É—â–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</span>
                        <div class="controls-row">
                            <button id="playPauseBtn" onclick="funClick()" class="button-color-purple">
                                <i data-lucide="play"></i>
                            </button>
                            <div class="time-fields">
                                <label for="startTime">Start:</label>
                                <input type="number" id="startTime" step="0.01" min="0" size="6">

                                <label for="endTime">End:</label>
                                <input type="number" id="endTime" step="0.01" min="0" size="6">
                            </div>
                        </div>
                    </div>
                </div>

                <table id="sentences-table-mp3">
                    <thead>
                        <tr>
                            <th>‚Ññ</th>
                            <th>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–æ—Ä–∏–≥–∏–Ω–∞–ª/–ø–µ—Ä–µ–≤–æ–¥)</th>
                            <th>Start</th>
                            <th>End</th>
                            <th>–¶–µ–ø–æ—á–∫–∞</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –°—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </section>

            <section class="page" id="page-audio-mic">
                –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∞—É–¥–∏–æ —Å–∞–º–∏...
            </section>
        </div>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        lucide.createIcons();
    </script>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç—ã UserManager -->
    <script src="{{ url_for('static', filename='js/language_manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/user_manager.js') }}"></script>

    <script id="init-data" type="application/json">
    {{ {
        "dictation_id": dictation_id,
        "editMode": edit_mode,
        "original_language": original_language,
        "translation_language": translation_language,
        "original_data": original_data,
        "translation_data": translation_data,
        "audio_file": audio_file,
        "title": title,
        "level": level,
        "audio_words": audio_words,
        "safe_email": safe_email
     } | tojson }}
    </script>


    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –°–ò–ù–•–†–û–ù–ù–û -->
    <script src="{{ url_for('static', filename='js/script_dictation_generator.js') }}"></script>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UserManager –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
        document.addEventListener('DOMContentLoaded', async function () {
            // console.log('üöÄ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –¥–∏–∫—Ç–∞–Ω—Ç–∞...');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ LanguageManager –∑–∞–≥—Ä—É–∂–µ–Ω
            // if (window.LanguageManager) {
            //     console.log('‚úÖ LanguageManager –¥–æ—Å—Ç—É–ø–µ–Ω');
            // }

            if (!window.UM) {
                console.warn('‚ö†Ô∏è UserManager –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä');
                window.UM = new UserManager({ apiBase: '/user/api' });
            } else {
                // console.log('‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π UserManager');
            }

            try {
                // –¢–µ–ø–µ—Ä—å –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
                if (typeof initDictationGenerator === 'function') {
                    initDictationGenerator();
                    // console.log('‚úÖ script_dictation_generator.js –∑–∞–≥—Ä—É–∂–µ–Ω');
                } else {
                    console.error('‚ùå script_dictation.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ');
                }
            } catch (error) {
                console.error('‚ùå JWT initialization error:', error);
                // –î–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–æ–±—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä
                if (typeof initDictationGenerator === 'function') {
                    initDictationGenerator();
                }
            }
        });
    </script>
</body>

</html>