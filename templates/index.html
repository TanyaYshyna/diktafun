<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Главная — Диктанты</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style_color.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/style_index.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- FancyTree -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.fancytree@2/dist/skin-lion/ui.fancytree.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery.fancytree@2.38.2/dist/jquery.fancytree-all-deps.min.js"></script>

</head>

<body>
    <div class="topbar">
        <img src="/static/icons/logo.svg" class="logo">
        <div class="user-section" id="user-section">
            <!-- Заполнится JavaScript -->
            <a href="/user/login">Войти</a>
            <a href="/user/register">Регистрация</a>
        </div>
    </div>

    <div class="panel">
        <h2>Список диктантов</h2>
        <div class="buttons-row">
            <div class="buttons-row-left">
                <div id="header-language-selector"></div>
                <!-- Выпадающий список -->
                <div class="tooltip-wrapper">
                    <select id="languageFilter">
                        <option value="learning_to_native">Изучаемый ⇒ Родной</option>
                        <option value="learning_only">Только изучаемый</option>
                        <option value="all">Все языки</option>
                    </select>
                </div>
                <div class="tooltip-wrapper">
                    <button id="btnAddNode">
                        <i data-lucide="trash-2"></i>
                    </button>
                </div>
                <div class="tooltip-wrapper">
                    <button id="btnDeleteNode">
                        <i data-lucide="folder-plus"></i>
                    </button>
                </div>
            </div>
            <div class="buttons-row-left-right">
                <a
                    href="{{ url_for('dictation_generator.dictation_generator', language_original='en', language_translation='ru') }}">
                    <button id="newDictationBtn" title="Создать документ">
                        <i data-lucide="file-plus-2"></i>
                    </button>
                </a>
            </div>
        </div>


        <div id="container-tree-cards">
            <div id="leftPanel">
                <div id="treeContainer"></div>
            </div>
            <div id="resizer"></div>
            <div id="rightPanel">
                <div id="text_tree_branch">ветка дерева</div>
                <div id="content">
                    <!-- <div id="dictationList"></div> -->
                    <div id="dictationsGrid" class="shorts-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Только общие данные -->
    <div id="global-config" 
        data-language-data='{{ language_data | tojson }}'
        data-categories-data='{{ categories_data | tojson }}' style="display: none;">
    </div>

    <!-- Для иконок -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script> lucide.createIcons(); </script>

    <!-- Передаем данные категорий из сервера в JavaScript -->
    <script type="application/json" id="categories-data">
    {{ categories_data | tojson | safe }}
    </script>


    <script src="{{ url_for('static', filename='js/user_manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/languageSelector.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script_index.js') }}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            console.log('DOM loaded, starting JWT initialization...');

            // Загружаем глобальные данные
            const globalConfig = document.getElementById('global-config');
            if (globalConfig) {
                window.LANGUAGE_DATA = JSON.parse(globalConfig.dataset.languageData || '{}');
                window.CATEGORIES_DATA = JSON.parse(globalConfig.dataset.categoriesData || '{}');
                console.log('Global data loaded');
            }

            // Устанавливаем значения по умолчанию для пользовательских настроек
            window.USER_LANGUAGE_DATA = {
                nativeLanguage: 'ru',
                learningLanguages: ['en'],
                currentLearning: 'en'
            };

            // Инициализируем UserManager
            window.UM = new UserManager({ apiBase: '/user/api' });

            try {
                await UM.init();
                console.log('UserManager initialized with JWT');

            } catch (error) {
                console.error('JWT initialization error:', error);
            }
        });
    </script>
</body>

</html>