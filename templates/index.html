<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>–ì–ª–∞–≤–Ω–∞—è ‚Äî –î–∏–∫—Ç–∞–Ω—Ç—ã</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style_color.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/style_index.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- FancyTree -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.fancytree@2/dist/skin-lion/ui.fancytree.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery.fancytree@2.38.2/dist/jquery.fancytree-all-deps.min.js"></script>

</head>

<body>
    <div class="topbar">
        <img src="/static/icons/logo.svg" class="logo">
        <div class="user-section" id="user-section">
            <!-- –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ) -->
            <div class="auth-buttons" style="display: none;">
                <a href="/user/login">–í–æ–π—Ç–∏</a>
                <a href="/user/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>

            <!-- –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ) -->
            <div class="user-info" style="display: none;">
                <a href="/user/profile" class="username">
                    <div class="user-avatar-small"></div>
                    <span class="username-text"></span>
                </a>
                <div class="streak">
                    <i data-lucide="flame"></i> <span class="streak-days">0</span>
                </div>
                <button id="logoutBtn" class="logout-btn">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <div class="panel">
        <h2>–°–ø–∏—Å–æ–∫ –¥–∏–∫—Ç–∞–Ω—Ç–æ–≤</h2>
        <div class="buttons-row">
            <div class="buttons-row-left">
                <div id="header-language-selector"></div> <!-- ‚Üê –≠–¢–û–¢ –≠–õ–ï–ú–ï–ù–¢ -->
                <!-- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ -->
                <div class="tooltip-wrapper">
                    <select id="languageFilter">
                        <option value="learning_to_native">–ò–∑—É—á–∞–µ–º—ã–π ‚áí –†–æ–¥–Ω–æ–π</option>
                        <option value="learning_only">–¢–æ–ª—å–∫–æ –∏–∑—É—á–∞–µ–º—ã–π</option>
                        <option value="all">–í—Å–µ —è–∑—ã–∫–∏</option>
                    </select>
                </div>
                <div class="tooltip-wrapper">
                    <button id="btnDeleteNode">
                        <i data-lucide="trash-2"></i>
                    </button>
                </div>
                <div class="tooltip-wrapper">
                    <button id="btnAddNode">
                        <i data-lucide="folder-plus"></i>
                    </button>
                </div>
            </div>
            <div class="buttons-row-left-right">
                <button id="newDictationBtn" onclick="newDictation()" title="–°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç">
                    <i data-lucide="file-plus-2"></i>
                </button>
            </div>
        </div>


        <div id="container-tree-cards">
            <div id="leftPanel">
                <div id="treeContainer"></div>
            </div>
            <div id="resizer"></div>
            <div id="rightPanel">
                <div id="text_tree_branch">–≤–µ—Ç–∫–∞ –¥–µ—Ä–µ–≤–∞</div>
                <div id="content">
                    <!-- <div id="dictationList"></div> -->
                    <div id="dictationsGrid" class="shorts-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- –¢–æ–ª—å–∫–æ –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ -->
    <div id="global-config" data-categories-data='{{ categories_data | tojson }}' style="display: none;">
    </div>

    <!-- –î–ª—è –∏–∫–æ–Ω–æ–∫ -->
    <script src="{{ url_for('static', filename='js/lucide.js') }}"></script>
    <script> lucide.createIcons(); </script>

    <!-- –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞ –≤ JavaScript -->
    <script type="application/json" id="categories-data">
    {{ categories_data | tojson | safe }}
    </script>

    <script src="{{ url_for('static', filename='js/language_manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/user_manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/language_selector.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script_index.js') }}"></script>

    <script>
        console.log('üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ UM:', {
            exists: !!window.UM,
            isAuthenticated: window.UM ? window.UM.isAuthenticated() : 'UM not found',
            user: window.UM ? window.UM.getCurrentUser() : 'no user'
        });

        // –£–ü–†–û–©–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ UM –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏:', {
                exists: !!window.UM,
                isAuthenticated: window.UM ? window.UM.isAuthenticated() : 'UM not found',
                user: window.UM ? window.UM.getCurrentUser() : 'no user'
            });
        });


        // document.addEventListener('DOMContentLoaded', async function () {
        //     if (window.UM) {
        //         try {
        //             // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ UM
        //             const isAuthenticated = window.UM.isAuthenticated && window.UM.isAuthenticated();
        //             console.log('üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ JWT:', isAuthenticated);

        //             if (isAuthenticated) {
        //                 const userData = window.UM.getCurrentUser();
        //                 console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', userData);
        //                 // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        //                 window.USER_LANGUAGE_DATA = {
        //                     nativeLanguage: userData.native_language || 'ru',
        //                     learningLanguages: userData.learning_languages || ['en'],
        //                     currentLearning: userData.current_learning || 'en',
        //                     isAuthenticated: true
        //                 };
        //             } else {
        //                 console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        //                 // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        //                 window.USER_LANGUAGE_DATA = {
        //                     nativeLanguage: 'ru',
        //                     learningLanguages: ['en'],
        //                     currentLearning: 'en',
        //                     isAuthenticated: false
        //                 };
        //             }
        //         } catch (error) {
        //             console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
        //         }
        //     }
        // });
    </script>
</body>

</html>